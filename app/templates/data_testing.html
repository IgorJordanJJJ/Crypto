<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Data Fetchers - Crypto DeFi Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/htmx.org@1.9.9"></script>
    <style>
        .status-success { color: #198754; }
        .status-error { color: #dc3545; }
        .status-loading { color: #0d6efd; }
        .json-container { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            border-radius: 0.375rem;
            max-height: 400px;
            overflow-y: auto;
        }
        .btn-test { margin: 5px; }
        .card-header { font-weight: bold; }
        pre { font-size: 0.875rem; }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Data Fetchers</h1>
                <p class="text-muted">–ü–∞–Ω–µ–ª—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</p>
            </div>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        ‚ÑπÔ∏è –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
                    </div>
                    <div class="card-body">
                        <button class="btn btn-outline-primary btn-sm" 
                                hx-get="/api/data/status"
                                hx-target="#system-status"
                                hx-indicator="#loading-status">
                            –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
                        </button>
                        <div id="loading-status" class="htmx-indicator">
                            <div class="spinner-border spinner-border-sm ms-2" role="status"></div>
                        </div>
                        <div id="system-status" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π -->
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-primary text-white">
                        üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <h6>Bybit API</h6>
                            <button class="btn btn-outline-success btn-sm btn-test" 
                                    hx-get="/api/data/test/bybit"
                                    hx-target="#bybit-test-result"
                                    hx-indicator="#loading-bybit">
                                üîó –¢–µ—Å—Ç Bybit API
                            </button>
                            <div id="loading-bybit" class="htmx-indicator">
                                <div class="spinner-border spinner-border-sm ms-2" role="status"></div>
                            </div>
                            <div id="bybit-test-result" class="mt-2"></div>
                        </div>

                        <div class="mb-3">
                            <h6>DefiLlama API</h6>
                            <button class="btn btn-outline-success btn-sm btn-test" 
                                    hx-get="/api/data/test/defillama"
                                    hx-target="#defillama-test-result"
                                    hx-indicator="#loading-defillama">
                                üîó –¢–µ—Å—Ç DefiLlama API
                            </button>
                            <div id="loading-defillama" class="htmx-indicator">
                                <div class="spinner-border spinner-border-sm ms-2" role="status"></div>
                            </div>
                            <div id="defillama-test-result" class="mt-2"></div>
                        </div>

                        <div class="mb-3">
                            <h6>YFinance API</h6>
                            <button class="btn btn-outline-success btn-sm btn-test" 
                                    hx-get="/api/data/test/yfinance"
                                    hx-target="#yfinance-test-result"
                                    hx-indicator="#loading-yfinance">
                                üîó –¢–µ—Å—Ç YFinance API
                            </button>
                            <div id="loading-yfinance" class="htmx-indicator">
                                <div class="spinner-border spinner-border-sm ms-2" role="status"></div>
                            </div>
                            <div id="yfinance-test-result" class="mt-2"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö -->
            <div class="col-lg-6 mb-4">
                <div class="card h-100">
                    <div class="card-header bg-warning text-dark">
                        üëÄ –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <h6>Crypto –¥–∞–Ω–Ω—ã–µ (Bybit)</h6>
                            <input type="number" id="crypto-limit" value="10" min="1" max="50" class="form-control form-control-sm d-inline-block w-auto me-2">
                            <button class="btn btn-outline-warning btn-sm btn-test" 
                                    hx-get="/api/data/sample/crypto"
                                    hx-include="#crypto-limit"
                                    hx-target="#crypto-sample-result"
                                    hx-indicator="#loading-crypto-sample"
                                    hx-vals='js:{"limit": document.getElementById("crypto-limit").value}'>
                                üìä –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã
                            </button>
                            <div id="loading-crypto-sample" class="htmx-indicator">
                                <div class="spinner-border spinner-border-sm ms-2" role="status"></div>
                            </div>
                            <div id="crypto-sample-result" class="mt-2"></div>
                        </div>

                        <div class="mb-3">
                            <h6>DeFi –¥–∞–Ω–Ω—ã–µ (DefiLlama)</h6>
                            <input type="number" id="defi-limit" value="10" min="1" max="50" class="form-control form-control-sm d-inline-block w-auto me-2">
                            <button class="btn btn-outline-warning btn-sm btn-test" 
                                    hx-get="/api/data/sample/defi"
                                    hx-include="#defi-limit"
                                    hx-target="#defi-sample-result"
                                    hx-indicator="#loading-defi-sample"
                                    hx-vals='js:{"limit": document.getElementById("defi-limit").value}'>
                                üìä –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã
                            </button>
                            <div id="loading-defi-sample" class="htmx-indicator">
                                <div class="spinner-border spinner-border-sm ms-2" role="status"></div>
                            </div>
                            <div id="defi-sample-result" class="mt-2"></div>
                        </div>

                        <div class="mb-3">
                            <h6>Crypto –¥–∞–Ω–Ω—ã–µ (YFinance)</h6>
                            <input type="number" id="yfinance-limit" value="10" min="1" max="20" class="form-control form-control-sm d-inline-block w-auto me-2">
                            <button class="btn btn-outline-warning btn-sm btn-test" 
                                    hx-get="/api/data/sample/yfinance"
                                    hx-include="#yfinance-limit"
                                    hx-target="#yfinance-sample-result"
                                    hx-indicator="#loading-yfinance-sample"
                                    hx-vals='js:{"limit": document.getElementById("yfinance-limit").value}'>
                                üìä –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã YFinance
                            </button>
                            <div id="loading-yfinance-sample" class="htmx-indicator">
                                <div class="spinner-border spinner-border-sm ms-2" role="status"></div>
                            </div>
                            <div id="yfinance-sample-result" class="mt-2"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        üöÄ –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ (—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î)
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <button class="btn btn-success btn-test w-100" 
                                        hx-post="/api/data/fetch/crypto"
                                        hx-target="#crypto-fetch-result"
                                        hx-indicator="#loading-crypto-fetch">
                                    üí∞ –ó–∞–≥—Ä—É–∑–∏—Ç—å Crypto –¥–∞–Ω–Ω—ã–µ
                                </button>
                                <div id="loading-crypto-fetch" class="htmx-indicator">
                                    <div class="spinner-border spinner-border-sm ms-2" role="status"></div>
                                </div>
                                <div id="crypto-fetch-result" class="mt-2"></div>
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <button class="btn btn-success btn-test w-100" 
                                        hx-post="/api/data/fetch/defi"
                                        hx-target="#defi-fetch-result"
                                        hx-indicator="#loading-defi-fetch">
                                    üè¶ –ó–∞–≥—Ä—É–∑–∏—Ç—å DeFi –¥–∞–Ω–Ω—ã–µ
                                </button>
                                <div id="loading-defi-fetch" class="htmx-indicator">
                                    <div class="spinner-border spinner-border-sm ms-2" role="status"></div>
                                </div>
                                <div id="defi-fetch-result" class="mt-2"></div>
                            </div>
                            
                            <div class="col-md-4 mb-3">
                                <button class="btn btn-primary btn-test w-100" 
                                        hx-post="/api/data/refresh"
                                        hx-target="#full-refresh-result"
                                        hx-indicator="#loading-full-refresh">
                                    üîÑ –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                                </button>
                                <div id="loading-full-refresh" class="htmx-indicator">
                                    <div class="spinner-border spinner-border-sm ms-2" role="status"></div>
                                </div>
                                <div id="full-refresh-result" class="mt-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-secondary text-white">
                        üîó –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏
                    </div>
                    <div class="card-body">
                        <a href="/" class="btn btn-outline-primary me-2">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                        <a href="/docs" class="btn btn-outline-info me-2" target="_blank">üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</a>
                        <a href="/cryptocurrencies" class="btn btn-outline-success me-2">üí∞ –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã</a>
                        <a href="/defi" class="btn btn-outline-warning me-2">üè¶ DeFi –ø—Ä–æ—Ç–æ–∫–æ–ª—ã</a>
                        <a href="/analytics" class="btn btn-outline-secondary me-2">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è JSON
        function formatJsonResponse(response, targetId) {
            const target = document.getElementById(targetId);
            if (!response) return;
            
            try {
                const data = typeof response === 'string' ? JSON.parse(response) : response;
                const status = data.status || 'unknown';
                const statusClass = status === 'success' ? 'status-success' : 'status-error';
                
                let html = `<div class="${statusClass}"><strong>–°—Ç–∞—Ç—É—Å:</strong> ${status}</div>`;
                html += `<div class="json-container mt-2"><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
                
                target.innerHTML = html;
            } catch (e) {
                target.innerHTML = `<div class="status-error">–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞: ${e.message}</div>`;
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω—ã—Ö HTMX –∑–∞–ø—Ä–æ—Å–æ–≤
        document.body.addEventListener('htmx:afterSwap', function(evt) {
            const target = evt.target;
            if (target.id && target.textContent) {
                try {
                    const data = JSON.parse(target.textContent);
                    formatJsonResponse(data, target.id);
                } catch (e) {
                    // –ï—Å–ª–∏ –Ω–µ JSON, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                }
            }
        });
    </script>
</body>
</html>